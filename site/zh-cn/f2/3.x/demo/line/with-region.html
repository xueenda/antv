<!--
index: 10
title: Florida 近 10 年失业率
resource:
  jsFiles:
    - ${url.jquery}
    - ${url.lodash}
-->

<script>
  $.getJSON('/assets/data/f2-line-with-region.json', function(data) {
    const chart = new F2.Chart({
      id: 'mountNode',
      width: window.innerWidth,
      height: window.innerWidth * 0.707,
      pixelRatio: window.devicePixelRatio
    });

    chart.source(data, {
      year: {
        range: [ 0, 1 ],
        ticks: [ 1997, 1999, 2001, 2003, 2005, 2007, 2009, 2011, 2013, 2015, 2017 ]
      },
      value: {
        tickCount: 10,
        formatter(val) {
          return val.toFixed(1) + '%';
        }
      }
    });

    chart.tooltip({
      custom(obj) {
        const legend = chart.get('legendController').legends.top[0];
        const tooltipItems = obj.items;
        const legendItems = legend.items;
        const map = {};
        legendItems.map(item => {
          map[item.name] = _.clone(item);
        });
        tooltipItems.map(item => {
          const { name, value } = item;
          if (map[name]) {
            map[name].value = value;
          }
        });
        legend.setItems(Object.values(map));
      },
      onHide() {
        const legend = chart.get('legendController').legends.top[0];
        legend.setItems(chart.getLegendItems().country);
      }
    });

    chart.guide().rect({
      start: [ 2011, 'max' ],
      end: [ 'max', 'min' ],
      style: {
        fill: '#CCD6EC',
        opacity: 0.3
      }
    });
    chart.guide().text({
      position: [ 2014, 'max' ],
      content: 'Scott administratio\n(2011 to present)',
      style: {
        fontSize: 10,
        textBaseline: 'top'
      }
    });

    chart.line().position('year*value').color('type', val => {
      if (val === 'United States') {
        return '#ccc';
      }
    });
    chart.render();

  });
</script>
